<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شحن لعبة ببجي موبايل– (MENA)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f4f7f6; }
        .price-btn { transition: all 0.2s ease; border: 1px solid #e2e8f0; background: white; text-align: center; }
        .price-btn:hover { border-color: #ff4500; color: #ff4500; background-color: #fffaf0; }
        .price-btn.active { background-color: #ff4500 !important; color: white !important; border-color: #ff4500; }
        .dashed-container { border: 2px dashed #ffb800; border-radius: 20px; background: white; }
        .payment-option { transition: all 0.3s ease; border: 1px solid #e2e8f0; cursor: pointer; }
        .payment-option.active { border-color: #ffb800; background-color: #fffdf5; border-width: 2px; }
        #checkout-page { display: none; }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-[#d97706] shadow-md p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-center items-center">
            <div class="h-10 md:h-16">
                <img src="https://i.postimg.cc/8kRqNLT0/logo.gif" alt="Logo" class="h-full w-auto">
            </div>
        </div>
    </header>

    <main id="product-page" class="max-w-6xl mx-auto mt-8 p-4 md:p-8 grid grid-cols-1 lg:grid-cols-2 gap-12 bg-white shadow-2xl rounded-3xl mb-12 border border-gray-100">
        <div class="space-y-6 text-right">
            <div class="overflow-hidden rounded-2xl border bg-gray-50 flex items-center justify-center p-4 h-[400px]">
                <img id="mainImage" src="https://i.postimg.cc/htFP1cSZ/pubg.png" alt="Free Fire MENA" class="max-w-full max-h-full object-contain transition-opacity duration-300">
            </div>
        </div>

        <div class="text-right">
            <h1 class="text-3xl font-black mb-1 text-gray-900">شحن لعبة ببجي موبايل– (MENA)</h1>
            <p id="displayPrice" class="text-orange-600 text-4xl font-black mb-8">اختر الحزمة</p>

            <h3 class="font-bold mb-4 text-gray-800 flex items-center gap-2">
                <span class="w-2 h-6 bg-orange-500 rounded-full"></span> اختر الكمية :
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-8">
                <button onclick="selectPrice(this, 1.10)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">60 UC</button>
                <button onclick="selectPrice(this, 5.45)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">325 UC</button>
                <button onclick="selectPrice(this, 10.50)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">660 UC</button>
                <button onclick="selectPrice(this, 25.60)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">1800 UC</button>
                <button onclick="selectPrice(this, 50.00)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">3850 UC</button>
                <button onclick="selectPrice(this, 99.00)" class="price-btn py-3 px-2 rounded-lg font-bold text-sm">8100 UC</button>
            </div>

            <div class="border-2 border-dashed border-orange-200 p-6 rounded-3xl bg-orange-50/30 mb-8">
                <h4 class="text-center font-bold mb-4 text-gray-800 underline underline-offset-8">معلومات الشحن</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="fName" placeholder="الاسم الشخصي" class="p-3 border rounded-xl text-right outline-none focus:border-orange-500">
                    <input type="text" id="lName" placeholder="اسم العائلة" class="p-3 border rounded-xl text-right outline-none focus:border-orange-500">
                    <input type="email" id="email" placeholder="البريد الإلكتروني" class="p-3 border rounded-xl text-right outline-none md:col-span-2 focus:border-orange-500">
                </div>
                <input type="text" id="billInfo" placeholder="أدخل معرف اللاعب (ID) الخاص بك هنا..." class="w-full mt-4 p-3 border rounded-xl text-right outline-none focus:border-orange-500">
            </div>

            <div class="flex flex-col md:flex-row items-center gap-4">
                <div class="flex items-center border-2 border-gray-100 rounded-2xl bg-white h-[60px]">
                    <button class="px-6 font-bold text-xl" onclick="stepUp()">+</button>
                    <input id="qty" type="number" value="1" class="w-12 text-center border-none font-black text-xl" readonly>
                    <button class="px-6 font-bold text-xl" onclick="stepDown()">-</button>
                </div>
                <button onclick="goToCheckout()" class="w-full md:flex-1 bg-red-600 text-white font-black py-5 rounded-2xl hover:bg-red-700 shadow-xl transition-all text-xl">
                    إتمام الشحن الآن
                </button>
            </div>
        </div>
    </main>

    <main id="checkout-page" class="max-w-5xl mx-auto mt-8 mb-12 p-4">
        <div class="dashed-container p-6 md:p-10 shadow-sm bg-white">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 text-right">
                <div class="lg:col-span-1">
                    <div class="border rounded-xl p-6 bg-white space-y-4">
                        <h3 class="text-gray-800 text-lg font-bold border-b pb-2 mb-4">ملخص الشحن</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center"><span class="text-gray-500">الحزمة:</span><span id="res-qty" class="font-bold">--</span></div>
                            <div class="flex justify-between items-center border-t pt-4 font-bold text-lg"><span>المجموع:</span><span id="res-price" class="text-orange-600 text-2xl">--</span></div>
                        </div>
                        <button onclick="goBack()" class="w-full text-xs text-gray-400 mt-4 underline text-center block">تغيير الحزمة</button>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-4">
                    <div class="payment-option active rounded-xl p-4 border-2 border-orange-400">
                        <div class="flex justify-between items-center"><input type="radio" name="pay" id="p1" checked><label for="p1" class="font-bold text-orange-800">BINANCE PAY</label></div>
                        <div class="mt-4 text-sm space-y-3">
                            <p>قم بإرسال USDT إلى هذا الحساب [ 120694333 ]</p>
                            <textarea id="txnId" placeholder="ID المعاملة..." class="w-full border rounded-lg p-3 h-24 text-right outline-none"></textarea>
                        </div>
                    </div>
                    <button id="finalBtn" onclick="finishAll()" class="w-full bg-orange-500 text-white font-black py-4 rounded-xl text-xl mt-6">تأكيد عملية الدفع</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const SUPABASE_URL = 'https://dxphurkzzkpiyiplpvwj.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_ev1gKdbdyrBmOBTgvcrzGA_kB3-ciNw';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let provider = "Free Fire - MENA"; 
        let selectedAmount = "";
        let unitPrice = 0;

        function selectPrice(b, p) {
            document.querySelectorAll('.price-btn').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            selectedAmount = b.innerText;
            unitPrice = p;
            document.getElementById('displayPrice').innerText = "$ " + p.toFixed(2);
        }

        function stepUp() { let q = document.getElementById('qty'); q.value = parseInt(q.value) + 1; updateFinalPrice(); }
        function stepDown() { let q = document.getElementById('qty'); if(q.value > 1) q.value = parseInt(q.value) - 1; updateFinalPrice(); }
        
        function updateFinalPrice() {
            if(unitPrice > 0) {
                let total = unitPrice * parseInt(document.getElementById('qty').value);
                document.getElementById('displayPrice').innerText = "$ " + total.toFixed(2);
            }
        }

        function goToCheckout() {
            if(!selectedAmount) { alert("يرجى اختيار الحزمة أولاً"); return; }
            if(!document.getElementById('fName').value || !document.getElementById('email').value || !document.getElementById('billInfo').value) {
                alert("يرجى ملء البيانات المطلوبة."); return;
            }
            let total = unitPrice * parseInt(document.getElementById('qty').value);
            document.getElementById('res-qty').innerText = selectedAmount + " (x" + document.getElementById('qty').value + ")";
            document.getElementById('res-price').innerText = "$ " + total.toFixed(2);
            document.getElementById('product-page').style.display = 'none';
            document.getElementById('checkout-page').style.display = 'block';
            window.scrollTo(0,0);
        }

        function goBack() { document.getElementById('product-page').style.display = 'grid'; document.getElementById('checkout-page').style.display = 'none'; }

        async function finishAll() {
            const btn = document.getElementById('finalBtn');
            const txn = document.getElementById('txnId').value;
            if(!txn) { alert("يرجى إدخال Transaction ID"); return; }
            btn.innerText = "جاري الإرسال..."; btn.disabled = true;

            const dataToInsert = {
                first_name: document.getElementById('fName').value,
                last_name: document.getElementById('lName').value,
                email: document.getElementById('email').value,
                bill_info: document.getElementById('billInfo').value,
                provider: provider,
                amount: document.getElementById('res-price').innerText, // نرسل السعر الإجمالي
                quantity: document.getElementById('qty').value,
                transaction_id: txn,
                payment_method: "Binance Pay"
            };

            try {
                const { error } = await _supabase.from('orders').insert([dataToInsert]);
                if (error) throw error;
                alert("تم استلام طلبك بنجاح!");
                location.reload();
            } catch (err) {
                alert("خطأ في الإرسال.");
            } finally { btn.disabled = false; }
        }
    </script>
</body>
</html>